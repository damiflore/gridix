System.register([__v__("/js/vendors.nomodule.js")],(function(e,t){"use strict";var o,l,n,i,r,c,s,a,d,h,m,u,g,p,y,f,X,Y,S,v,w,b,x,M,C,N,P,I,G,D,T,A,E,R,j,O,L,B,k,W,z,F,V,H,q,J,U,K,Q,Z,$,_,ee,te,oe,le,ne,ie,re,ce,se,ae,de,he,me,ue,ge,pe,ye,fe,Xe;return{setters:[function(e){o=e.w}],execute:function(){l=({x:e,y:t})=>Math.sqrt(e*e+t*t),n=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),i=(e,t)=>1===t?e:{x:e.x*t,y:e.y*t},r=(e,t)=>e.x*t.x+e.y*t.y,c=(e,t)=>e.x*t.y-e.y*t.x,e("r",s=(e,{centerX:t,centerY:o,angle:l})=>{if(0===l)return e;const n=e.x-t,i=e.y-o,r=Math.sin(l),c=Math.cos(l);return{x:n*c-i*r+t,y:n*r+i*c+o}}),a=e=>{const t=l(e);if(t>0){const o=1/t;return{x:e.x*o,y:e.y*o}}return{x:e.x*t,y:e.y*t}},d=(e,{centerX:t,centerY:o,radius:l})=>((e,t)=>{const o=e.x-t.x,l=e.y-t.y;return Math.sqrt(o*o+l*l)})(e,{x:t,y:o})<=l,h=(e,t)=>{const o=e.x,l=e.y,{centerX:n,centerY:i,width:r,height:c}=t,s=n-r/2;if(o<s)return!1;if(o>s+r)return!1;const a=i-c/2;return!(l<a)&&!(l>a+c)},m=(e,t)=>{const o=t.centerX,l=t.centerY,n=t.angle,i=s(e,{centerX:o,centerY:l,angle:-n});return h(i,t)},u=({width:e=0,height:t=0,centerX:o=0,centerY:l=0,angle:n=0}={})=>({shapeName:"rectangle",width:e,height:t,centerX:o,centerY:l,angle:n}),e("b",g=({centerX:e,centerY:t,width:o,height:l,angle:n})=>s({x:e-o/2,y:t-l/2},{centerX:e,centerY:t,angle:n})),p=({centerX:e,centerY:t,width:o,height:l,angle:n})=>({topLeftCorner:g({centerX:e,centerY:t,width:o,height:l,angle:n}),topRightCorner:s({x:e+o/2,y:t-l/2},{centerX:e,centerY:t,angle:n}),bottomRightCorner:s({x:e+o/2,y:t+l/2},{centerX:e,centerY:t,angle:n}),bottomLeftCorner:s({x:e-o/2,y:t+l/2},{centerX:e,centerY:t,angle:n})}),y=({centerX:e,centerY:t,width:o,height:l,angle:i})=>{const{topLeftCorner:r,topRightCorner:c,bottomRightCorner:s,bottomLeftCorner:d}=p({centerX:e,centerY:t,width:o,height:l,angle:i});return{topNormal:a(n(c,s)),rightNormal:a(n(s,d)),bottomNormal:a(n(d,r)),leftNormal:a(n(r,c))}},f=({centerX:e,centerY:t,width:o,height:l,angle:n,strokeStyle:i,fillStyle:r,lineWidth:c,alpha:s},a)=>{const d=g({centerX:e,centerY:t,width:o,height:l,angle:n});a.save(),a.beginPath(),a.translate(d.x,d.y),a.rotate(n),a.rect(0,0,o,l),a.closePath(),a.globalAlpha=s,a.lineWidth=c,i&&(a.strokeStyle=i,a.stroke()),r&&(a.fillStyle=r,a.fill()),a.restore()},e("a",X=(e,t,o,l)=>(e.addEventListener(t,o,l),()=>{e.removeEventListener(t,o,l)})),e("i",Y=(e,{onload:t=()=>{}}={})=>{const o=document.createElement("link");o.rel="stylesheet",o.type="text/css";const l=((e,t)=>{const o=X(e,"load",(()=>{l(),t()})),l=X(e,"error",(()=>{o(),t()}));return()=>{o(),l()}})(o,t);return o.href=e,document.head.appendChild(o),()=>{l(),document.head.removeChild(o)}}),S=e=>{const{shapeName:t}=e;if("circle"===t)return M(e);if("rectangle"===t){const{angle:t}=e;if(0===t)return N(e);const{width:o,height:l}=e;return(o>l?o/l:l/o)<3||o*l<6?C(e):P(e)}return null},v=(e,t)=>{const o=e.boundingBoxShapeName,l=t.boundingBoxShapeName;return"circle"===o&&"circle"===l?w(e,t):"rectangle"===o&&"rectangle"===l?b(e,t):"circle"===o&&"rectangle"===l?x(e,t):"rectangle"===o&&"circle"===l&&x(t,e)},w=(e,t)=>{const o={x:e.centerX-t.centerX,y:e.centerY-t.centerY};return!(l(o)>e.radius+t.radius)},b=(e,t)=>!(e.right<=t.left||e.left>=t.right||e.bottom<=t.top||e.top>=t.bottom),x=(e,t)=>{const o=e.radius,l=e.centerX,n=e.centerY,i=t.left,r=t.right,c=t.top,s=t.bottom,a=l-(l<i?i:l>r?r:l),d=n-(n<c?c:n>s?s:n);return Math.sqrt(a*a+d*d)<=o},M=e=>({boundingBoxShapeName:"bounding-circle",centerX:e.centerX,centerY:e.centerY,radius:e.radius}),C=e=>{const t=e.width,o=e.height;return{boundingBoxShapeName:"bounding-circle",centerX:e.centerX,centerY:e.centerY,radius:Math.sqrt(t*t+o*o)/2}},N=({centerX:e,centerY:t,width:o,height:l})=>{const n=o/2,i=l/2;return{boundingBoxShapeName:"rectangle",left:e-n,top:t-i,right:e+n,bottom:t+i}},P=e=>{const{topLeftCorner:t,topRightCorner:o,bottomRightCorner:l,bottomLeftCorner:n}=p(e),i=Math.min(t.x,o.x,l.x,n.x),r=Math.min(t.y,o.y,l.y,n.y);return{boundingBoxShapeName:"rectangle",left:i,top:r,right:i+Math.max(t.x,o.x,l.x,n.x),bottom:r+Math.max(t.y,o.y,l.y,n.y)}},I=({collisionDepth:e=0,collisionNormalX:t=0,collisionNormalY:o=0,collisionStartX:l=0,collisionStartY:n=0,collisionEndX:i=l+t*e,collisionEndY:r=n+o*e})=>({collisionDepth:e,collisionNormalX:t,collisionNormalY:o,collisionStartX:l,collisionStartY:n,collisionEndX:i,collisionEndY:r}),G=(e,t)=>{const o=p(e),n=y(e),c=Object.keys(o),s=Object.keys(n),d=t.centerX,h=t.centerY,m=t.radius;let u,g=0,f=!0,X=-1/0;for(;g<4;){const e=o[c[g]],t=n[s[g]],l={x:d-e.x,y:h-e.y},i=r(l,t);if(i>0){X=i,u=g,f=!1;break}i>X&&(X=i,u=g),g++}const Y=n[s[u]];if(f){const e=i(Y,m);return I({collisionDepth:m-X,collisionNormalX:Y.x,collisionNormalY:Y.y,collisionStartX:d-e.x,collisionStartY:h-e.y})}const S=o[c[u]],v=o[c[(u+1)%4]],w={x:d-S.x,y:h-S.y},b={x:v.x-S.x,y:v.y-S.y};if(r(w,b)<0){const e=l(w);if(e>m)return null;const t=a(w),o=i(t,-m);return I({collisionDepth:m-e,collisionNormalX:t.x,collisionNormalY:t.y,collisionStartX:d+o.x,collisionStartY:h+o.y})}const x={x:d-v.x,y:h-v.y},M=i(b,-1);if(r(x,M)<0){const e=l(x);if(e>m)return null;const t=a(x),o=i(t,-m);return I({collisionDepth:m-e,collisionNormalX:t.x,collisionNormalY:t.y,collisionStartX:d+o.x,collisionStartY:h+o.y})}if(X<m){const e=i(Y,m);return I({collisionDepth:m-X,collisionNormalX:Y.x,collisionNormalY:Y.y,collisionStartX:d-e.x,collisionStartY:h-e.y})}return null},D=(e,t)=>{const o=y(e),l=p(e),n=Object.keys(o),r=Object.keys(l),c=p(t);let s,a,d=1/0,h=0;for(;h<4;){const e=o[n[h]],t=l[r[h]];h++;const m=i(e,-1),u=T(c,m,t);if(!u)return null;const{supportPointDistance:g}=u;g<d&&(d=g,s=u,a=e)}const m=i(a,d);return I({collisionDepth:d,collisionNormalX:a.x,collisionNormalY:a.y,collisionStartX:s.supportPointX+m.x,collisionStartY:s.supportPointY+m.y})},T=(e,t,o)=>{let l=-1/0,i=null,c=null;const s=Object.keys(e);let a=0;for(;a<4;){const d=e[s[a]];a++;const h=n(d,o),m=r(h,t);m>0&&m>l&&(l=m,i=d.x,c=d.y)}return null===i?null:{supportPointX:i,supportPointY:c,supportPointDistance:l}},A=(e,t)=>{if((e.debugCollisionDetection||t.debugCollisionDetection)&&(e.debugCollisionDetection=!1,t.debugCollisionDetection=!1),!((e,t)=>{const o=S(e);if(!o)return!1;const l=S(t);return!!l&&v(o,l)})(e,t))return null;const o=R(e,t);if(!o)return null;const l={x:o.collisionNormalX,y:o.collisionNormalY},n={x:t.centerX-e.centerX,y:t.centerY-e.centerY};return r(l,n)<0?E(o):o},E=({collisionDepth:e,collisionNormalX:t,collisionNormalY:o,collisionStartX:l,collisionStartY:n,collisionEndX:i,collisionEndY:r})=>({collisionDepth:e,collisionNormalX:-1*t,collisionNormalY:-1*o,collisionStartX:i,collisionStartY:r,collisionEndX:l,collisionEndY:n}),R=(e,t)=>{const o=e.shapeName,r=t.shapeName;return"circle"===o&&"circle"===r?((e,t)=>{const o=n({x:t.centerX,y:t.centerY},{x:e.centerX,y:e.centerY}),r=l(o),c=e.radius+t.radius;if(r>c)return null;if(0===r)return e.radius>t.radius?I({collisionDepth:c,collisionNormalX:0,collisionNormalY:-1,collisionStartX:t.centerX,collisionStartY:t.centerY+t.radius}):I({collisionDepth:c,collisionNormalX:0,collisionNormalY:-1,collisionStartX:e.centerX,collisionStartY:e.centerY+e.radius});const s=a(o),d=a(i(o,-1)),h=i(d,t.radius);return I({collisionDepth:c-r,collisionNormalX:s.x,collisionNormalY:s.y,collisionStartX:t.centerX+h.x,collisionStartY:t.centerY+h.y})})(e,t):"rectangle"===o&&"rectangle"===r?((e,t)=>{const o=D(e,t);if(!o)return null;const l=D(t,e);if(!l)return null;const n=o.collisionDepth,i=l.collisionDepth;if(n<i){const e=o.collisionNormalX,t=o.collisionNormalY,l=o.collisionStartX,i=o.collisionStartY;return I({collisionDepth:n,collisionNormalX:e,collisionNormalY:t,collisionStartX:l-e*n,collisionStartY:i-t*n})}return I({collisionDepth:i,collisionNormalX:-1*l.collisionNormalX,collisionNormalY:-1*l.collisionNormalY,collisionStartX:l.collisionStartX,collisionStartY:l.collisionStartY})})(e,t):"rectangle"===o&&"circle"===r?G(e,t):"circle"===o&&"rectangle"===r?G(t,e):null},j=({rigidBodies:e,canCollidePredicate:t=()=>!0,pairCollisionCallback:o})=>{((e,t)=>{let o=0;for(;o<e.length;){const l=e[o];o++;let n=o;for(;n<e.length;){const o=e[n];n++,t(l,o)}}})(e,((e,l)=>{if(t(e,l)){const t=A(e,l);t&&o(e,l,t)}}))},O=(e,{x:t=0,y:o=0,angle:l=0})=>{const{mass:n}=e;e.forces.push({x:t*n,y:o*n,angle:l*n})},L=e=>{let t=0,o=0,l=0;return e.forEach((({x:e=0,y:n=0,angle:i=0})=>{t+=e,o+=n,l+=i})),{x:t,y:o,angle:l}},B=e=>!(e<0)&&0!==e&&e!==1/0,k=({a:e,b:t,collisionInfo:o,collisionPositionResolution:l,collisionVelocityImpact:n,bounceThreshold:i})=>{const r=e.mass,c=t.mass,s=B(r)?1/r:0,a=B(c)?1/c:0,d=s+a;(e.debugCollisionResolution||t.debugCollisionResolution)&&(e.debugCollisionResolution=!1,t.debugCollisionResolution=!1),l&&W(e,t,{aMassInverted:s,bMassInverted:a,massInvertedSum:d,collisionInfo:o}),n&&z(e,t,{aMassInverted:s,bMassInverted:a,massInvertedSum:d,bounceThreshold:i,collisionInfo:o})},W=(e,t,{aMassInverted:o,bMassInverted:l,massInvertedSum:n,collisionInfo:i})=>{const{collisionDepth:r,collisionNormalX:c,collisionNormalY:s}=i,a=r/n*1,d=e.centerX+c*a*o*-1,h=e.centerY+s*a*o*-1;e.centerX=d,e.centerY=h;const m=t.centerX+c*a*l,u=t.centerY+s*a*l;t.centerX=m,t.centerY=u},z=(e,t,{aMassInverted:o,bMassInverted:l,massInvertedSum:n,bounceThreshold:s,collisionInfo:d})=>{const h=e.velocityX,m=e.velocityY,u=t.velocityX,g=t.velocityY,p=e.velocityAngle,y=t.velocityAngle,{collisionNormalX:f,collisionNormalY:X,collisionStartX:Y,collisionStartY:S,collisionEndX:v,collisionEndY:w}=d,b={x:f,y:X},x=l/n,M=o/n,C=Y*x+v*M,N=S*x+w*M,P={x:C-e.centerX,y:N-e.centerY},I={x:C-t.centerX,y:N-t.centerY},G=u+-1*y*I.y-(h+-1*p*P.y),D=g+y*I.x-(m+p*P.x),T=r({x:G,y:D},b);if(T>0)return;if(-T<s)return;const A=F(e),E=F(t),R=Math.min(e.restitution,t.restitution),j=c(P,b),O=c(I,b),L=-(1+R),B=L*T/(n+j*j*A+O*O*E),k=f*B,W=X*B,z=h-k*o,V=m-W*o,H=u+k*l,q=g+W*l,J=p-j*B*A,U=y+O*B*E,K=i(a({x:G-f*T,y:D-X*T}),-1),Q=r({x:G,y:D},K),Z=c(P,K),$=c(I,K),_=n+Z*Z*A+$*$*E,ee=Math.min(e.friction,t.friction),te=Math.min(L*Q*ee/_,B),oe=K.x*te,le=K.y*te,ne=z-oe*o,ie=V-le*o,re=H+oe*l,ce=q+le*l,se=J-Z*te*A,ae=U+$*te*E;e.velocityX=ne,e.velocityY=ie,e.velocityAngle=se,t.velocityX=re,t.velocityY=ce,t.velocityAngle=ae},F=e=>{const{shapeName:t}=e;return"circle"===t?V(e):"rectangle"===t?H(e):0},V=({mass:e,radius:t,rotationInertiaCoef:o})=>B(e)?e*(t*t)*o:0,H=({mass:e,width:t,height:o,rotationInertiaCoef:l})=>B(e)?1/(e*(t*t+o*o)*l):0,q=(e,{stepInfo:t,move:o,sleepMoveThreshold:l,sleepForceThreshold:n,sleepVelocityThreshold:i,sleepStartDuration:r,onRigidBodyMoved:c})=>{if(!B(e.mass))return;e.debugSleep&&(e.debugSleep=!1);const s=!J({move:o,sleepMoveThreshold:l});if(e.sleeping)return void((s||U(e,{sleepForceThreshold:n,sleepVelocityThreshold:i}))&&(e.lastNotableMotionTime=t.time,e.sleeping=!1,c(e,o)));if(s)return e.lastNotableMotionTime=t.time,void c(e,o);const a=e.lastNotableMotionTime;t.time-a<r||Object.assign(e,{sleeping:!0,forceXWhenSleepStarted:e.forceX,forceYWhenSleepStarted:e.forceY,forceAngleWhenSleepStarted:e.forceAngle,velocityXWhenSleepStarted:e.velocityX,velocityYWhenSleepStarted:e.velocityY,velocityAngleWhenSleepStarted:e.velocityAngle})},J=({move:e,sleepMoveThreshold:t})=>!(Math.abs(e.x)>t||Math.abs(e.y)>t||Math.abs(e.angle)>t),U=(e,{sleepVelocityThreshold:t,sleepForceThreshold:o})=>{const{velocityX:l,velocityXWhenSleepStarted:n}=e;if(Math.abs(n-l)>t)return!0;const{velocityY:i,velocityYWhenSleepStarted:r}=e;if(Math.abs(r-i)>t)return!0;const{velocityAngle:c,velocityAngleWhenSleepStarted:s}=e;if(Math.abs(s-c)>t)return!0;const{forceX:a,forceXWhenSleepStarted:d}=e;if(Math.abs(d-a)>o)return!0;const{forceY:h,forceYWhenSleepStarted:m}=e;if(Math.abs(m-h)>o)return!0;const{forceAngle:u,forceAngleWhenSleepStarted:g}=e;return Math.abs(g-u)>o},K=({sleepMoveThreshold:e=.01,sleepForceThreshold:t=1,sleepVelocityThreshold:o=.1,sleepStartDuration:l=2,bounceThreshold:n=1,onRigidBodyAdded:i=()=>{},onRigidBodyCollision:r=()=>{},onRigidBodyMoved:c=()=>{},onRigidBodyRemoved:s=()=>{}}={})=>{const a={},d=[];return Object.assign(a,{step:i=>{(({rigidBodies:e,stepInfo:t})=>{const{timePerFrame:o}=t,l=[];e.forEach((e=>{e.debugMotion&&(e.debugMotion=!1);const{mass:t,velocityX:n,velocityY:i,velocityAngle:r,forces:c}=e;if(!B(t))return c.length>0&&(c.length=0),void((n||i||r)&&(e.velocityX=e.velocityY=e.velocityAngle=0));const s=L(c);if(c.length=0,e.forceX=s.x,e.forceY=s.y,e.forceAngle=s.angle,e.sleeping)return;const a=t,d=1-e.frictionAmbient,h=s.x/a,m=s.y/a,u=s.angle/a,g=(n+h*o)*d,p=(i+m*o)*d,y=e.angleLocked?0:(r+u*o)*d;e.velocityX=g,e.velocityY=p,e.velocityAngle=y;const{centerX:f,centerY:X,angle:Y}=e,S=f+g*o,v=X+p*o,w=Y+y*o;f===S&&X===v&&Y===w||(e.centerX=S,e.centerY=v,e.angle=w,l.push({rigidBody:e,from:{centerX:f,centerY:X,angle:Y},to:{centerX:S,centerY:v,angle:w}}))}))})({rigidBodies:d,stepInfo:i}),(({rigidBodies:e,bounceThreshold:t,onRigidBodyCollision:o,collisionPositionResolution:l,collisionVelocityImpact:n})=>{let i=5;for(;i--;)j({rigidBodies:e,canCollidePredicate:(e,t)=>{const o=e.sleeping||!B(e.mass),l=t.sleeping||!B(t.mass);return!o||!l},pairCollisionCallback:(e,i,r)=>{o({a:e,b:i,collisionInfo:r}),k({a:e,b:i,collisionInfo:r,collisionPositionResolution:l,collisionVelocityImpact:n,bounceThreshold:t})}})})({rigidBodies:d,bounceThreshold:n,collisionPositionResolution:!0,collisionVelocityImpact:!0,onRigidBodyCollision:r}),(({rigidBodies:e,stepInfo:t,sleepMoveThreshold:o,sleepForceThreshold:l,sleepVelocityThreshold:n,sleepStartDuration:i,onRigidBodyMoved:r})=>{e.forEach((e=>{const{centerX:c,centerY:s,angle:a}=e,{centerXPrev:d,centerYPrev:h,anglePrev:m}=e;e.centerXPrev=c,e.centerYPrev=s,e.anglePrev=a,void 0!==d&&q(e,{stepInfo:t,move:{from:{x:d,y:h,angle:m},to:{x:c,y:s,angle:a},x:c-d,y:s-h,angle:a-m},sleepMoveThreshold:o,sleepForceThreshold:l,sleepVelocityThreshold:n,sleepStartDuration:i,onRigidBodyMoved:r})}))})({rigidBodies:d,stepInfo:i,sleepMoveThreshold:e,sleepForceThreshold:t,sleepVelocityThreshold:o,sleepStartDuration:l,onRigidBodyMoved:c})},addRigidBody:e=>{d.push(e),i(e)},removeRigidBody:e=>{const t=d.indexOf(e);-1!==t&&(d.splice(t,1),s(e))}}),a},Q=new URL(__v__("/css/world.css"),t.meta.url),Z=async e=>{const{injectDevtools:o}=await t.import(__v__("/js/devtools_injector.nomodule.js"));o(e)},$=(e,t)=>{const{shapeName:o}=t;return"circle"===o?d(e,t):"rectangle"===o&&((e,t)=>t.angle?m(e,t):h(e,t))(e,t)},_=({x:e,y:t},{cellSize:o,cellXCount:l,cellYCount:n})=>{if(e<0)return-1;const i=e/o;if(i>l)return-1;if(t<0)return-1;const r=t/o;if(r>n)return-1;const c=Math.floor(i),s=Math.floor(r);return oe({cellX:c,cellY:s},{cellXCount:l})},ee=(e,{cellSize:t})=>e*t+t/2,te=(e,{cellSize:t})=>e*t+t/2,oe=({cellX:e,cellY:t},{cellXCount:o})=>e+t*o,le=(e,t)=>e<0?e<-t?-t:e:e>t?t:e,e("c",((e,t,o=1/0)=>e<t?t:e>o?o:e)),ne=(e,t)=>e<0?t<0:t>0,ie={rigid:!0,centerX:0,centerY:0,angle:0,angleLocked:!1,velocityX:0,velocityY:0,velocityAngle:0,forceX:0,forceY:0,forceAngle:0,mass:1,friction:.8,frictionAmbient:.02,restitution:.2,rotationInertiaCoef:.2,sleeping:!1,lastNotableMotionTime:0,centerXPrev:void 0,centerYPrev:void 0,anglePrev:void 0,forceXWhenSleepStarted:0,forceYWhenSleepStarted:0,forceAngleWhenSleepStarted:0,velocityXWhenSleepStarted:0,velocityYWhenSleepStarted:0,velocityAngleWhenSleepStarted:0,debugMotion:!1,debugCollisionResolution:!1,debugCollisionDetection:!1,debugSleep:!1},re=e=>({...ie,forces:[],...e}),ce=(e,t)=>{const{velocityX:o,velocityY:l}=e,n=Math.abs(o);if(n>10)return;const i=Math.abs(l);if(i>10)return;const{centerX:r,centerY:c}=e,s=(({x:e,y:t},{cellSize:o})=>({x:Math.floor(e/o)*o+o/2,y:Math.floor(t/o)*o+o/2}))({x:r,y:c},t),a=s.x-r;if(n>i){if(0===o)return;if(!ne(a,o))return;if(Math.abs(a)<.1)return;return void O(e,{x:50*a})}const d=s.y-c;0!==l&&ne(d,l)&&(Math.abs(d)<.1||O(e,{y:50*d}))},se=(e,t,o)=>{e.centerX=ee(((e,{cellXCount:t})=>e%t)(t,o),o),e.centerY=te(((e,{cellXCount:t})=>Math.floor(e/t))(t,o),o)},ae=({node:e,code:t,onpress:o=()=>{},onrelease:l=()=>{}})=>{const n={isDown:!1,downTimeStamp:0,upTimeStamp:0},i=X(e,"keydown",(e=>{e.code===t&&(e.preventDefault(),n.isDown||(n.isDown=!0,n.downTimeStamp=e.timeStamp,o()))})),r=X(e,"keyup",(e=>{e.code===t&&(e.preventDefault(),n.isDown&&(n.isDown=!1,n.upTimeStamp=e.timeStamp,l()))}));return n.untrack=()=>{i(),r()},n},de=(e,t)=>e.isDown&&t.isDown?e.downTimeStamp>t.downTimeStamp?-1:1:e.isDown?-1:t.isDown?1:0,he=({side:e,centerX:t,centerY:o,width:l,height:n})=>{const i=u({centerX:t,centerY:o,width:l,height:n});return{...re({...i,mass:1/0,restitution:0}),name:"world-bound-".concat(e)}},me=({gameObject:e,worldGrid:t,reason:o})=>{if("add"===o){const o=-1,l=_({x:e.centerX,y:e.centerY},t);if(e.cellIndex=l,-1===l)return;const n=t.cells[l]||[];ge(t,l,e),n.forEach((t=>{t.onCellMateJoin&&t.onCellMateJoin(e,{cellIndexPrevious:o})}))}const l=e.cellIndex,n=_({x:e.centerX,y:e.centerY,angle:e.angle},t);if(l===n)return;if(e.cellIndex=n,-1!==l&&ue(t,l,e).forEach((t=>{t.onCellMateLeave&&t.onCellMateLeave(e)})),-1===n)return;const i=t.cells[n]||[];ge(t,n,e),i.forEach((t=>{t.onCellMateJoin&&t.onCellMateJoin(e,{cellIndexPrevious:l})}))},ue=(e,t,o)=>{const l=e.cells,n=l[t];if(!n){const e=[];return l[t]=e,e}let i=n.length;const r=[];for(;i--;){const e=n[i];e!==o&&r.push(e)}return l[t]=r,r},ge=(e,t,o)=>{const l=e.cells,n=l[t];if(n){const e=[...n,o];return l[t]=e,e}const i=[o];return l[t]=i,i},pe=()=>o.state,ye=e=>(o.addEventListener("statechange",e),()=>{o.removeEventListener("statechange",e)}),fe=(()=>{const e={cellXCount:10,cellYCount:10,cellSize:32,cells:[]};e.cells=(e=>{const t=(({cellXCount:e,cellYCount:t})=>t*e-1)(e);return new Array(t+1)})(e),window.worldGrid=e;const t=(({devtools:e=!0,container:t,worldWidth:o=0,worldHeight:l=0,onGameObjectAdded:n=()=>{},onGameObjectMoved:i=()=>{},onGameObjectRemoved:r=()=>{}})=>{Y(Q);const c=[],s=[],a={worldWidth:o,worldHeight:l},d=document.createElement("div");d.className="world",t.appendChild(d);const h=document.createElement("div");h.className="world-view",d.appendChild(h);const m=document.createElement("div");m.className="world-view-wrapper",m.style.width="".concat(a.worldWidth,"px"),m.style.height="".concat(a.worldHeight,"px"),h.appendChild(m);const u=document.createElement("canvas");u.width=a.worldWidth,u.height=a.worldHeight,m.appendChild(u);const g=u.getContext("2d"),p=K({collisionCallback:({collisionInfo:e})=>{s.push(e)},onRigidBodyMoved:i,collisionPositionResolution:!0,collisionVelocityImpact:!0}),y=e=>c.filter((t=>$(e,t)));return Object.assign(a,{update:e=>{c.forEach((t=>{const{update:o}=t;o&&o(t,e)})),s.length=0,p.step(e)},draw:()=>{s.forEach((e=>{(({collisionStartX:e,collisionStartY:t,collisionEndX:o,collisionEndY:l},n)=>{n.beginPath(),n.moveTo(e,t),n.lineTo(o,l),n.closePath(),n.strokeStyle="orange",n.stroke()})(e,g)})),g.clearRect(0,0,a.worldWidth,a.worldHeight),c.forEach((e=>{const{draw:t}=e;t&&(e.strokeStyle="blue",e.lineWidth=1,e.alpha=e.sleeping?.5:1,e.draw(e,g))}))},getGameObjects:()=>c,addGameObject:e=>{c.push(e),e.rigid&&p.addRigidBody(e),n(e)},countGameObjects:()=>c.length,forEachGameObject:e=>{c.forEach(e)},removeGameObject:e=>{const t=c.indexOf(e);t>-1&&(p.removeRigidBody(e),c.splice(t,1),r(e))},gameObjectFromPoint:e=>{const t=y(e);return t[t.length-1]},gameObjectsFromPoint:y,simulation:p}),e&&Z({world:a,worldNode:d}),a.devtools={opened:!1},a})({devtools:!0,container:document.querySelector("#app"),worldWidth:e.cellXCount*e.cellSize,worldHeight:e.cellYCount*e.cellSize,onGameObjectAdded:t=>{"number"==typeof t.centerX&&me({gameObject:t,worldGrid:e,reason:"add"})},onGameObjectMoved:(t,o)=>{o.from&&t.onMove&&t.onMove(o),me({gameObject:t,worldGrid:e,reason:"move"})}}),o=({cellX:o,cellY:l})=>{const n=(({cellX:e,cellY:t,worldGrid:o})=>{const l=u({centerX:ee(e,o),centerY:te(t,o),width:o.cellSize,height:o.cellSize});return{...re({...l,angleLocked:!0,mass:1/0,rigid:!0,friction:.2}),name:"wall",fillStyle:"black",draw:f}})({cellX:o,cellY:l,worldGrid:e});t.addGameObject(n)},l=({cellX:o,cellY:l})=>{const n=(({cellX:e,cellY:t,worldGrid:o})=>{const l=u({centerX:ee(e,o),centerY:te(t,o),width:o.cellSize,height:o.cellSize}),n={...re({...l,angleLocked:!0,sleeping:!0,mass:1,friction:.2,frictionAmbient:.7}),name:"baril",fillStyle:"brown",draw:f,update:()=>{n.frictionAmbient=n.flagIce?.02:.7},onMove:()=>{ce(n,o)}};return n})({cellX:o,cellY:l,worldGrid:e});t.addGameObject(n)},n=({cellX:o,cellY:l})=>{const n=(({cellX:e,cellY:t,worldGrid:o})=>({...u({centerX:ee(e,o),centerY:te(t,o),width:o.cellSize,height:o.cellSize}),name:"ice",onCellMateJoin:e=>{e.flagIce=!0},onCellMateLeave:e=>{e.flagIce=!1},draw:f,fillStyle:"lightblue"}))({cellX:o,cellY:l,worldGrid:e});t.addGameObject(n)},i=({cellX:o,cellY:l})=>{const n=(({cellX:e,cellY:t,worldGrid:o,force:l=-6e3})=>{const n={...u({centerX:ee(e,o),centerY:te(t,o),width:o.cellSize,height:o.cellSize}),name:"sidewalk",update:()=>{o.cells[n.cellIndex].forEach((e=>{e!==n&&((e,t)=>{e.forces.push(t)})(e,{y:l,origin:n})}))},draw:f,fillStyle:"lightgreen"};return n})({cellX:o,cellY:l,worldGrid:e,force:-6e3});t.addGameObject(n)},r=(({worldWidth:e,worldHeight:t,worldBoundSize:o=32})=>({left:he({side:"left",centerX:-o/2,centerY:t/2,width:o,height:t}),top:he({side:"top",centerX:e/2,centerY:-o/2,width:e+2*o,height:o}),right:he({side:"right",centerX:e+o/2,centerY:t/2,width:o,height:t}),bottom:he({side:"bottom",centerX:e/2,centerY:t+o/2,width:e+2*o,height:o})}))({worldWidth:t.worldWidth,worldHeight:t.worldHeight});Object.keys(r).forEach((e=>{t.addGameObject(r[e])}));const c={current:null},s=(({maxAccel:e=25e3,maxDecel:t=1e4,keyboardVelocity:o=200,heroRef:l}={})=>{const n=ae({code:"ArrowDown",node:document}),i=ae({code:"ArrowUp",node:document}),r=ae({code:"ArrowLeft",node:document}),c=ae({code:"ArrowRight",node:document});return{name:"keyboard-navigation",update:(s,{timePerFrame:a})=>{const d=l.current,h=d.flagIce?o+50:o;let m=0;const u=de(r,c);if(u){const{velocityX:o}=d,l=h*u-o,n=ne(o,u)?e:t;m=le(l/a,n*d.frictionAmbient)}let g=0;const p=de(i,n);if(p){const{velocityY:o}=d,l=h*p-o,n=ne(o,p)?e:t;g=le(l/a,n*d.frictionAmbient)}(m||g)&&O(d,{x:m,y:g})}}})({heroRef:c});return t.addGameObject(s),i({cellX:5,cellY:1}),i({cellX:5,cellY:2}),i({cellX:5,cellY:3}),(({cellX:o,cellY:l})=>{const n=(({cellX:e,cellY:t,worldGrid:o})=>({...u({centerX:ee(e,o),centerY:te(t,o),width:o.cellSize,height:o.cellSize}),name:"ice",onCellMateJoin:(e,{cellIndexPrevious:t})=>{se(e,t,o)},draw:f,fillStyle:"violet"}))({cellX:o,cellY:l,worldGrid:e});t.addGameObject(n)})({cellX:6,cellY:5}),o({cellX:1,cellY:0}),o({cellX:1,cellY:1}),l({cellX:1,cellY:2}),l({cellX:2,cellY:2}),l({cellX:5,cellY:3}),o({cellX:1,cellY:3}),n({cellX:3,cellY:7}),n({cellX:4,cellY:7}),n({cellX:5,cellY:7}),n({cellX:3,cellY:8}),n({cellX:4,cellY:8}),n({cellX:5,cellY:8}),n({cellX:6,cellY:7}),n({cellX:6,cellY:8}),c.current=(({cellX:o,cellY:l})=>{const n=(({cellX:e,cellY:t,worldGrid:o})=>{const l=u({centerX:ee(e,o),centerY:te(t,o),width:32,height:32}),n={...re({...l,angleLocked:!0,mass:1,friction:.01}),name:"hero",update:()=>{n.frictionAmbient=n.flagIce?.02:.2},fillStyle:"red",draw:f};return n})({cellX:o,cellY:l,worldGrid:e});return t.addGameObject(n),n})({cellX:0,cellY:0}),t})(),window.world=fe,Xe=(({framePerSecond:e=60,maxUpdatePerFrame:t=5,update:o=()=>{},draw:l=()=>{}})=>{let n,i,r=!1,c=!1;const s={framePerSecond:e,maxUpdatePerFrame:t},a={time:0,timePerFrame:0,framePerSecondEstimation:0,memoryUsed:null,memoryLimit:null},d=()=>{const{framePerSecond:e,maxUpdatePerFrame:t}=s,i=1/e,r=1e3*i,c=Date.now(),d=n?c-n:r;n=c;const h=Math.floor(d/r);let m;if(h>t)console.warn("too many updates to perform, only ".concat(t," out of ").concat(h," iterations will be done")),m=t;else{if(m=h,0===m)return;m>1&&console.info("perform ".concat(m," updates to catch up"))}for(a.timePerFrame=i,a.framePerSecondEstimation=Math.round(1e3/d),a.memoryUsed=Math.round(window.performance.memory.usedJSHeapSize/1048576),a.memoryLimit=window.performance.memory.jsHeapSizeLimit/1048576;m--;)a.time+=i,o(a);l(a)},h=()=>{r&&(i=requestAnimationFrame(h),c||d())};return Object.assign(s,{isPaused:()=>c,isStopped:()=>!r,onPausedStateChange:()=>{},onStoppedStateChange:()=>{},startGameLoop:()=>{r||(r=!0,s.onStoppedStateChange(!1),h())},pauseGameLoop:()=>{c||(c=!0,s.onPausedStateChange(!0))},resumeGameLoop:()=>{c&&(c=!1,n=void 0,s.onPausedStateChange(!1))},nextGameStep:()=>{n=void 0,d()},stopGameLoop:()=>{r&&(r=!1,window.cancelAnimationFrame(i),n=void 0,s.onStoppedStateChange(!0))}}),s})({framePerSecond:60,update:e=>{fe.update(e)},draw:e=>{fe.draw(e)}}),window.addEventListener("error",(e=>{console.error(e.message),Xe.stopGameLoop()})),(({active:e=()=>{},passive:t=()=>{},hidden:o=()=>{},frozen:l=()=>{},terminated:n=()=>{},notifyCurrent:i=!0})=>{const r={active:e,passive:t,hidden:o,frozen:l,terminated:n},c=()=>{const e=pe();r[e]()};i&&c(),ye(c)})({active:()=>{fe.devtools.opened||Xe.resumeGameLoop(),document.title="active"},passive:()=>{fe.devtools.opened||Xe.resumeGameLoop(),document.title="passive"},hidden:()=>{Xe.pauseGameLoop(),document.title="hidden"},frozen:()=>{Xe.pauseGameLoop()}}),window.requestIdleCallback((()=>{Xe.startGameLoop()}),{timeout:800}),window.gameEngine=Xe,window.splashscreen.remove()}}}));