System.register([],(function(){"use strict";return{execute:function(){var n=function(n,o,t){return n.addEventListener(o,t),function(){n.removeEventListener(o,t)}},o=function(){return window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches},t=function(n){var o=window.matchMedia("(display-mode: standalone)");return o.addListener(n),function(){o.removeListener(n)}};var e,i=(e=function(){return window.beforeinstallpromptEvent?(window.beforeinstallpromptEvent.prompt(),n=window.beforeinstallpromptEvent.userChoice,o=function(n){return"accepted"===n.outcome},t?o?o(n):n:(n&&n.then||(n=Promise.resolve(n)),o?n.then(o):n)):(console.warn("cannot promptAddToHomescreen: window.beforeinstallpromptEvent is missing"),!1);var n,o,t},function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{return Promise.resolve(e.apply(this,n))}catch(n){return Promise.reject(n)}}),r=function(){return Boolean(window.beforeinstallpromptEvent)},a=function(n){var o=n.beforeinstallpromptEventAvailableOnWindow,t=n.displayModeIsStandalone,e=n.appInstalledEvent;return!!o&&(!t&&!e)},c=function(o){return n(window,"beforeinstallprompt",o)};function l(n,o){(null==o||o>n.length)&&(o=n.length);for(var t=new Array(o),e=0;e<o;e++)t[e]=n[e];return t}var u=function(n){return function(n){if(Array.isArray(n))return l(n)}(n)||function(n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||function(n,o){if(n){if("string"==typeof n)return l(n,o);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(n,o):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()};function s(n,o,t){return t?o?o(n):n:(n&&n.then||(n=Promise.resolve(n)),o?n.then(o):n)}var d=window.navigator.serviceWorker;function f(n){return function(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];try{return Promise.resolve(n.apply(this,o))}catch(n){return Promise.reject(n)}}}function v(n,o,t){if(t)return o?o(n()):n();try{var e=Promise.resolve(n());return o?e.then(o):e}catch(n){return Promise.reject(n)}}function p(n,o){var t=n();return t&&t.then?t.then(o):o(t)}var w,h=Boolean(d)&&"https:"===document.location.protocol,m=null,y=null,g=(w=[],{listen:function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=o.once,e=void 0!==t&&t;if(e){var i=n;n=function(){a(),i.apply(void 0,arguments)}}w=[].concat(u(w),[n]);var r=!1,a=function(){if(!r){r=!0;for(var o=[],t=w.length,e=!0;t--;){var i=w[t];e&&i===n?e=!1:o.push(i)}w=o}};return a},emit:function(){for(var n=arguments.length,o=new Array(n),t=0;t<n;t++)o[t]=arguments[t];w.forEach((function(n){n.apply(void 0,o)}))}}),b=function(n){y&&y===n?console.log("we already know this worker is updating"):(n?console.log("found a worker updating (worker state is: ".concat(n.state,")")):console.log("worker update is done"),y=n,g.emit())},X=f((function(){return m?s(m,(function(n){return s(n.update(),(function(n){var o=n.installing;if(o)return console.log("installing worker found after calling update()"),b(o),!0;var t=n.waiting;return t?(console.log("waiting worker found after calling update()"),b(t),!0):(console.log("no worker found after calling update()"),!1)}))})):(console.warn("registerServiceWorker must be called before checkServiceWorkerUpdate can be used"),!1)})),Y=function(n){if(y)return function(n,o){var t=new MessageChannel,e=t.port1,i=t.port2;return new Promise((function(t,r){e.onmessage=function(n){"rejected"===n.data.status?r(n.data.value):t(n.data.value)},n.postMessage(o,[i])}))}(y,n);console.warn("no service worker updating to send message to")},E=f((function(n){if(!y)throw new Error("no service worker update to activate");return k(y,n)})),k=f((function(o){var t=!1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.onActivating,r=void 0===i?function(){}:i,a=e.onActivated,c=void 0===a?function(){}:a,l=e.onBecomesNavigatorController,u=void 0===l?function(){}:l,s=o.state,f=function(){return new Promise((function(t){var e=n(o,"statechange",(function(){"activating"===o.state&&r(),"activated"===o.state&&(c(),e(),t())}))}))};return p((function(){if("installed"===s||"activating"===s)return"installed"===s&&Y({action:"skipWaiting"}),v(f,(function(){if(d.controller)var o=n(d,"controllerchange",(function(){o(),u(),b(null),O()}));else b(null),O();t=!0}))}),(function(n){if(t)return n;u(),b(null),O()}))})),S=!0,M=!1,O=function(){M||(M=!0,window.location.reload())};if(h)n(d,"controllerchange",O);var A,C=function(n){return(new DOMParser).parseFromString(n,"text/html")},P=C("<button disabled>Add to home screen</button>").querySelector("button");function j(n,o,t){if(t)return o?o(n()):n();try{var e=Promise.resolve(n());return o?e.then(o):e}catch(n){return Promise.reject(n)}}function I(n){return function(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];try{return Promise.resolve(n.apply(this,o))}catch(n){return Promise.reject(n)}}}function x(){}if(document.body.appendChild(P),P.onclick=function(){i()},function(n){var e,i=!1,l=function(o){var t=o.beforeinstallpromptEventAvailableOnWindow,r=o.displayModeIsStandalone,c=a({beforeinstallpromptEventAvailableOnWindow:t,displayModeIsStandalone:r,appInstalledEvent:i});c!==e&&(e=c,n(c))};l({beforeinstallpromptEventAvailableOnWindow:r(),displayModeIsStandalone:o()});var u=c((function(n){window.beforeinstallpromptEvent=n,l({beforeinstallpromptEventAvailableOnWindow:!0,displayModeIsStandalone:o()})})),s=t((function(){l({beforeinstallpromptEventAvailableOnWindow:r(),displayModeIsStandalone:o()})})),d=function(n){return window.addEventListener("appinstalled",n),function(){window.removeEventListener("appinstalled",n)}}((function(){i=!0,l({beforeinstallpromptEventAvailableOnWindow:r(),displayModeIsStandalone:o()})}))}((function(n){P.disabled=!n})),(requestIdleCallback||requestAnimationFrame)((function(){!function(o){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).scope;if(!h)return function(){};var e=!1,i=function(){},r=function(){};s(m=d.register(o,{scope:t}),(function(o){if(i=function(){o.unregister()},e)i();else{var t=o.installing;o.waiting,o.active,r=n(o,"updatefound",(function(){console.log("browser notifies use an worker is installing"),o.installing!==t?b(o.installing):console.log("it's not an worker update, it's first time worker registers")}))}}))}("/service-worker.js")})),h){var L=C("\n<button>Check update</button>\n<p></p>\n"),D=L.querySelector("button"),W=L.querySelector("p");document.body.appendChild(D),document.body.appendChild(W),D.onclick=I((function(){return D.disabled=!0,W.innerHTML="checking for update",j(X,(function(n){n||(D.disabled=!1,W.innerHTML="No update available")}))})),A=function(){Boolean(y?{shouldBecomeNavigatorController:Boolean(d.controller),navigatorWillReload:S}:null)?(W.innerHTML="Update available <button>Activate update</button>",W.querySelector("button").onclick=I((function(){return W.querySelector("button").disabled=!0,j(E,x,n);var n}))):W.innerHTML=""},g.listen(A)}var T=function(n,o){if(null===n)return{};var t,e,i=function(n,o){if(null===n)return{};var t,e,i={},r=Object.keys(n);for(e=0;e<r.length;e++)t=r[e],o.indexOf(t)>=0||(i[t]=n[t]);return i}(n,o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(e=0;e<r.length;e++)t=r[e],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i},z=function(n,o,t){return o in n?Object.defineProperty(n,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[o]=t,n};function q(n){for(var o=1;o<arguments.length;o++){var t=null===arguments[o]?{}:arguments[o];o%2?B(Object(t),!0).forEach((function(o){z(n,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))}))}return n}function B(n,o){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);o&&(e=e.filter((function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable}))),t.push.apply(t,e)}return t}var H=function(n,o){var t=o.alpha,e=o.fillStyle,i=o.strokeStyle,r=o.image,a=o.imageSourceX,c=o.imageSourceY,l=o.positionX,u=o.positionY,s=o.width,d=o.height;n.globalAlpha=t,e&&(n.fillStyle=e,n.fill()),i&&(n.strokeStyle=i,n.stroke()),r&&(n.clip(),n.drawImage(r,a,c,s,d,l,u,s,d)),n.restore()},R={name:"anonymous",positionX:0,positionY:0,zIndex:0,width:0,height:0,blocCollidingArray:[],canCollide:!1,accelerationX:0,accelerationY:0,velocityX:0,velocityY:0,friction:.01,restitution:1,mass:1,fillStyle:void 0,strokeStyle:void 0,alpha:1,image:void 0,imageSourceX:void 0,imageSourceY:void 0,updates:{},effects:{},draw:function(n,o){o.beginPath(),o.rect(n.positionX,n.positionY,n.width,n.height),o.closePath(),H(o,n)}},F=function(n,o){Object.assign(n,o)},U=function(n){var o=n.positionX,t=n.positionY;return{x:o+n.width/2,y:t+n.height/2}},N=function(n,o){var t=n.positionX,e=t+n.width,i=o.positionX;if(e<=i)return!1;if(t>=i+o.width)return!1;var r=n.positionY,a=r+n.height,c=o.positionY;return!(a<=c)&&!(r>=c+o.height)},V={"collision-detection":function(n,o){var t=o.blocs;return{blocCollidingArray:G(n,t)}}},G=function(n,o){return o.filter((function(o){return o!==n&&(e=n,!!(t=o).canCollide&&!!e.canCollide&&N(t,e));var t,e}))},$={container:function(n,o){o.blocs.forEach((function(o){var t=o.velocityX,e=o.velocityY,i=o.positionX,r=o.width,a=i+r,c=o.positionY,l=o.height,u=c+l,s=n.positionX,d=n.positionY,f=s+n.width,v=d+n.height,p=n.restitution,w={};i<s?(w.positionX=s,w.velocityX=Math.abs(t)*p):a>f&&(w.positionX=f-r,w.velocityX=-Math.abs(t)*p),c<d?(w.positionY=d,w.velocityY=Math.abs(e)*p):u>v&&(w.positionY=v-l,w.velocityY=-Math.abs(e)*p),F(o,w)}))}},J={"collision-resolution":function(n){n.blocCollidingArray.forEach((function(o){var t=U(n),e=U(o),i=t.x-e.x,r=t.y-e.y,a=n.width/2+o.width/2,c=n.height/2+o.height/2;if(Math.abs(i)<a&&Math.abs(r)<c){var l=a-Math.abs(i),u=c-Math.abs(r);l>=u?r>0?n.positionY+=u:n.positionY-=u:i>0?n.positionX+=l:n.positionX-=l}}))}},K=function(n){var o=n.width,t=n.height,e=document.createElement("canvas");return e.width=o,e.height=t,e},Q={friction:function(n){var o=n.velocityX,t=n.velocityY,e=1-n.friction;return{velocityX:Math.round(o*e),velocityY:Math.round(t*e)}}},Z={velocity:function(n,o){var t=n.velocityX,e=n.velocityY,i=n.positionX,r=n.positionY,a=o.msEllapsed/1e3;return{positionX:Math.round(i+t*a),positionY:Math.round(r+e*a)}}},_=32,nn=function(n,o,t,e){return n.addEventListener(o,t,e),function(){n.removeEventListener(o,t,e)}},on=function(n){var o=n.node,t=n.code,e=n.onpress,i=void 0===e?function(){}:e,r=n.onrelease,a=void 0===r?function(){}:r,c={isDown:!1},l=nn(o,"keydown",(function(n){n.code===t&&(n.preventDefault(),c.isDown||(c.isDown=!0,i()))})),u=nn(o,"keyup",(function(n){n.code===t&&(n.preventDefault(),c.isDown&&(c.isDown=!1,a()))}));return c.untrack=function(){l(),u()},c};window.splashscreen.remove();var tn,en,rn,an,cn=function(n){var o=n.row;return{positionX:n.column*_,positionY:o*_,width:_,height:_}},ln=function(n){var o=n.row,t=n.column;return q(q(q({},R),{},{name:"floor"},cn({row:o,column:t})),{},{fillStyle:"white"})},un=function(n){var o=n.row,t=n.column,e=T(n,["row","column"]);return q(q(q({},R),{},{name:"wall",zIndex:1,canCollide:!0},cn({row:o,column:t})),{},{fillStyle:"grey"},e)},sn=[ln({row:0,column:0}),ln({row:1,column:0}),ln({row:2,column:0}),un({row:0,column:1}),un({row:1,column:1}),ln({row:2,column:1}),un({row:0,column:2}),ln({row:1,column:2}),ln({row:2,column:2}),un({row:3,column:3}),un({row:3,column:4}),un({row:3,column:1}),un({row:4,column:3}),un({row:4,column:4}),un({row:0,column:5}),(tn={row:2,column:1},en=tn.row,rn=tn.column,an=T(tn,["row","column"]),q(q(q({},R),{},{name:"baril",mass:100,friction:.6,canCollide:!0,canMove:!0,updates:q(q({},Q),Z),effects:q(q({},V),J)},cn({row:en,column:rn})),{},{zIndex:1,fillStyle:"brown"},an)),un({row:0,column:3}),un({row:6,column:1}),un({row:6,column:2}),un({row:6,column:3})],dn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.worldContainer,t=void 0!==o&&o,e=n.drawAfterUpdate,i=void 0!==e&&e,r=n.rowCount,a=n.columnCount,c=n.cellSize,l=void 0===c?32:c,s=n.worldMagneticGrid,d=void 0!==s&&s,f=n.blocs,v=r*l,p=a*l,w=K({width:v,height:p}),h=w.getContext("2d"),m=q(q({},R),{},{name:"world",updates:q({},d?{"magnetic-grid":function(n,o){o.blocs.forEach((function(n){if(n.canMove){var o=n.velocityX,t=n.positionX,e=Math.round(t/l)*l,i=t-e;console.log(i,o),i&&Math.abs(i)<5&&Math.abs(o)<5&&(i<0&&(console.log("attire vers la droite",{positionX:t,closestRowX:e}),n.velocityX=50),i>0&&(console.log("attire vers la gauche",{positionX:t,closestRowX:e}),n.velocityX=-50))}}))}}:{}),effects:q({},t?$:{}),positionX:0,positionY:0,width:v,height:p,restitution:0});f.push(m);var y,g=[],b=function(n){g.forEach((function(o){o(n)})),f.forEach((function(o){Object.keys(o.updates).forEach((function(t){F(o,o.updates[t](o,{blocs:f,msEllapsed:n}))}))})),i&&X(),f.forEach((function(o){Object.keys(o.effects).forEach((function(t){F(o,o.effects[t](o,{blocs:f,msEllapsed:n}))}))})),X()},X=function(){h.clearRect(0,0,w.width,w.height),u(f).sort((function(n,o){return n.zIndex>o.zIndex?1:n.zIndex<o.zIndex?-1:n.positionY>o.positionY?1:n.positionY<o.positionY?-1:n.positionX>o.positionX?1:n.positionX<o.positionX?-1:0})).forEach((function(n){n.draw(n,h)}))},Y=!1,E=function(){Y=!1,window.cancelAnimationFrame(y)},k=function(){if(!Y){Y=!0,b(0);var n=performance.now();!function o(){Y&&(y=window.requestAnimationFrame((function(){var t=performance.now(),e=t-n;n=t,b(e),o()})))}()}},S=function(n){var o=n.x,t=n.y;return f.filter((function(n){return h.isPointInPath(n.path,o,t)}))};return{canvas:w,start:k,stop:E,draw:X,blocsFromPoint:S,addTickCallback:function(n){g.push(n)}}}({worldContainer:!0,rowCount:7,columnCount:7,cellSize:32,blocs:sn});document.body.appendChild(dn.canvas),dn.start();var fn=on({code:"ArrowDown",node:dn.canvas}),vn=on({code:"ArrowUp",node:dn.canvas}),pn=on({code:"ArrowLeft",node:dn.canvas}),wn=on({code:"ArrowRight",node:dn.canvas}),hn=function(n){var o=n.row,t=n.column;return q(q(q({},R),{},{name:"hero",canCollide:!0,canMove:!0,friction:.5,zIndex:1,mass:10,keyboardVelocity:100,updates:q(q({},Q),{},{keyboardNavigation:function(n){var o=n.velocityX,t=n.velocityY,e=n.keyboardVelocity;return{velocityX:pn.isDown?-e:wn.isDown?e:o,velocityY:vn.isDown?-e:fn.isDown?e:t}}},Z),effects:q(q({},V),{},{"push-baril":function(n){n.blocCollidingArray.forEach((function(o){if(!("baril"!==o.name||n.velocityX&&n.velocityY)){var t,e,i,r,a,c,l,u=o,s=(e=(t=n).velocityX,i=t.velocityY,{movingLeft:e<0,movingTop:i<0,movingRight:e>0,movingBottom:i>0}),d=s.movingTop,f=s.movingRight,v=s.movingBottom;s.movingLeft&&(r=u,a=n.positionX,c=r.positionX,l=c+r.width,a<l&&a>c&&a-l)&&F(u,{velocityX:u.velocityX+n.velocityX}),d&&function(n,o){var t=n.positionY,e=o.positionY,i=e+o.height;return t<i&&t>e?t-i:0}(n,u)&&F(u,{velocityY:u.velocityY+n.velocityY}),f&&function(n,o){var t=n.positionX+n.width,e=o.positionX,i=e+o.width;return t>e&&t<i?t-e:0}(n,u)&&F(u,{velocityX:u.velocityX+n.velocityX}),v&&function(n,o){var t=n.positionY+n.height,e=o.positionY,i=e+o.height;return t>e&&t<i?t-e:0}(n,u)&&F(u,{velocityY:u.velocityY+n.velocityY})}}))}},J)},cn({row:o,column:t})),{},{width:24,height:24,fillStyle:"red"})}({row:0,column:0});sn.push(hn),dn.canvas.addEventListener("click",(function(n){var o,t,e,i={x:n.offsetX,y:n.offsetY},r=(t=(o=i).x,e=o.y,{x:Math.floor(t/_)*_,y:Math.floor(e/_)*_});mn(hn,{positionX:r.x,positionY:r.y})})),dn.canvas.setAttribute("tabindex",-1);var mn=function(n,o){var t=o.positionX,e=void 0===t?n.positionX:t,i=o.positionY,r=void 0===i?n.positionY:i,a={positionX:n.positionX,positionY:n.positionY};F(n,{positionX:e,positionY:r}),G(n,sn).length>0&&F(n,a)},yn=document.createElement("button");yn.innerHTML="pause",yn.onclick=function(){dn.stop()};var gn=document.createElement("button");gn.innerHTML="play",gn.onclick=function(){dn.start()},document.body.appendChild(document.createElement("br")),document.body.appendChild(yn),document.body.appendChild(gn),window.game=dn,window.blocs=sn}}}));

//# sourceMappingURL=main-6434e1cb.js.map